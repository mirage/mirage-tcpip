<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Keepalive (tcpip.Tcp.Keepalive)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tcpip</a> &#x00BB; <a href="../index.html">Tcp</a> &#x00BB; Keepalive</nav><header class="odoc-preamble"><h1>Module <code><span>Tcp.Keepalive</span></code></h1><p>TCP keepalives.</p><p>A TCP implementation may send &quot;keep-alives&quot; (empty TCP ACKs with the sequence number set to one less than the current sequence number for the connection) in order to provoke the peer to respond with an ACK of the current sequence number. If the peer doesn't recognise the connection (e.g. because the connection state has been dropped) then it will return a RST; if the peer (or the network in-between) fails to respond to a configured number of repeated probes then the connection is assumed to be lost.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-action"><a href="#type-action" class="anchor"></a><code><span><span class="keyword">type</span> action</span><span> = </span><span>[ </span></code><ol><li id="type-action.SendProbe" class="def variant constructor anchored"><a href="#type-action.SendProbe" class="anchor"></a><code><span>| </span><span>`SendProbe</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>we should send a keep-alive now</p><span class="comment-delim">*)</span></div></li><li id="type-action.Wait" class="def variant constructor anchored"><a href="#type-action.Wait" class="anchor"></a><code><span>| </span><span>`Wait <span class="keyword">of</span> <span class="xref-unresolved">Duration</span>.t</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>sleep for a given number of nanoseconds</p><span class="comment-delim">*)</span></div></li><li id="type-action.Close" class="def variant constructor anchored"><a href="#type-action.Close" class="anchor"></a><code><span>| </span><span>`Close</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>connection should be closed</p><span class="comment-delim">*)</span></div></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>An I/O action to perform</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-state"><a href="#type-state" class="anchor"></a><code><span><span class="keyword">type</span> state</span></code></div><div class="spec-doc"><p>State of a current connection</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alive"><a href="#val-alive" class="anchor"></a><code><span><span class="keyword">val</span> alive : <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p>An alive connection</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next"><a href="#val-next" class="anchor"></a><code><span><span class="keyword">val</span> next : 
  <span><span class="label">configuration</span>:<a href="../../Tcpip/Tcp/Keepalive/index.html#type-t">Tcpip.Tcp.Keepalive.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ns</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-action">action</a> * <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p><code>next ~configuration ~ns state</code> returns the action we should take given that we last received a packet <code>ns</code> nanoseconds ago and the new state of the connection</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A keep-alive timer</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><a href="../../Tcpip/Tcp/Keepalive/index.html#type-t">Tcpip.Tcp.Keepalive.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>[ `SendProbe <span>| `Close</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create configuration f clock</code> returns a keep-alive timer which will call <code>f</code> in future depending on both the <code>configuration</code> and any calls to <code>refresh</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-refresh"><a href="#val-refresh" class="anchor"></a><code><span><span class="keyword">val</span> refresh : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>refresh t</code> marks the connection <code>t</code> as alive. This should be called when packets are received.</p></div></div></div></body></html>
