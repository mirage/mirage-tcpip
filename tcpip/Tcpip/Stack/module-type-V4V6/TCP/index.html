<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>TCP (tcpip.Tcpip.Stack.V4V6.TCP)</title><link rel="stylesheet" href="../../../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">tcpip</a> &#x00BB; <a href="../../../index.html">Tcpip</a> &#x00BB; <a href="../../index.html">Stack</a> &#x00BB; <a href="../index.html">V4V6</a> &#x00BB; TCP</nav><header class="odoc-preamble"><h1>Module <code><span>V4V6.TCP</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> <span class="keyword">nonrec</span> error</span><span> = <span class="keyword">private</span> </span><span>[&gt; </span></code><ol><li id="type-error.Tcp.error" class="def type anchored"><a href="#type-error.Tcp.error" class="anchor"></a><code><span>| </span></code><code><span><a href="../../../Tcp/index.html#type-error">Tcp.error</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for TCP errors.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-write_error"><a href="#type-write_error" class="anchor"></a><code><span><span class="keyword">type</span> <span class="keyword">nonrec</span> write_error</span><span> = <span class="keyword">private</span> </span><span>[&gt; </span></code><ol><li id="type-write_error.Tcp.write_error" class="def type anchored"><a href="#type-write_error.Tcp.write_error" class="anchor"></a><code><span>| </span></code><code><span><a href="../../../Tcp/index.html#type-write_error">Tcp.write_error</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for TCP write errors.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ipaddr"><a href="#type-ipaddr" class="anchor"></a><code><span><span class="keyword">type</span> ipaddr</span><span> = <span class="xref-unresolved">Ipaddr</span>.t</span></code></div><div class="spec-doc"><p>The type for IP address representations.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-flow"><a href="#type-flow" class="anchor"></a><code><span><span class="keyword">type</span> flow</span></code></div><div class="spec-doc"><p>A flow represents the state of a single TCP stream that is connected to an endpoint.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type representing the internal state of the TCP layer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><code><span><span class="keyword">val</span> disconnect : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Disconnect from the TCP layer. While this might take some time to complete, it can never result in an error.</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="xref-unresolved">Mirage_flow</span>.S
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">flow</span> := <span class="xref-unresolved">flow</span></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <span class="xref-unresolved">error</span> := <span class="xref-unresolved">error</span></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <span class="xref-unresolved">write_error</span> := <span class="xref-unresolved">write_error</span></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><a href="#type-error">error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_write_error"><a href="#val-pp_write_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_write_error : <span><a href="#type-write_error">write_error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span><span class="xref-unresolved">Cstruct</span>.t <span class="xref-unresolved">Mirage_flow</span>.or_eof</span>, <a href="#type-error">error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-writev"><a href="#val-writev" class="anchor"></a><code><span><span class="keyword">val</span> writev : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-dst"><a href="#val-dst" class="anchor"></a><code><span><span class="keyword">val</span> dst : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-ipaddr">ipaddr</a> * int</span></code></div><div class="spec-doc"><p>Get the destination IP address and destination port that a flow is currently connected to.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_nodelay"><a href="#val-write_nodelay" class="anchor"></a><code><span><span class="keyword">val</span> write_nodelay : 
  <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>write_nodelay flow buffer</code> writes the contents of <code>buffer</code> to the flow. The thread blocks until all data has been successfully transmitted to the remote endpoint. Buffering within the layer is minimized in this mode. Note that this API will change in a future revision to be a per-flow attribute instead of a separately exposed function.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-writev_nodelay"><a href="#val-writev_nodelay" class="anchor"></a><code><span><span class="keyword">val</span> writev_nodelay : 
  <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Cstruct</span>.t list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>writev_nodelay flow buffers</code> writes the contents of <code>buffers</code> to the flow. The thread blocks until all data has been successfully transmitted to the remote endpoint. Buffering within the layer is minimized in this mode. Note that this API will change in a future revision to be a per-flow attribute instead of a separately exposed function.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_connection"><a href="#val-create_connection" class="anchor"></a><code><span><span class="keyword">val</span> create_connection : 
  <span>?keepalive:<a href="../../../Tcp/Keepalive/index.html#type-t">Tcp.Keepalive.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-ipaddr">ipaddr</a> * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-flow">flow</a>, <a href="#type-error">error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>create_connection ~keepalive t (addr,port)</code> opens a TCP connection to the specified endpoint.</p><p>If the optional argument <code>?keepalive</code> is provided then TCP keep-alive messages will be sent to the server when the connection is idle. If no responses are received then eventually the connection will be disconnected: <code>read</code> will return <code>Ok `Eof</code> and write will return <code>Error `Closed</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-listen"><a href="#val-listen" class="anchor"></a><code><span><span class="keyword">val</span> listen : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>port:int <span class="arrow">&#45;&gt;</span></span>
  <span>?keepalive:<a href="../../../Tcp/Keepalive/index.html#type-t">Tcp.Keepalive.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>listen t ~port ~keepalive callback</code> listens on <code>port</code>. The <code>callback</code> is executed for each flow that was established. If <code>keepalive</code> is provided, this configuration will be applied before calling <code>callback</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if <code>port &lt; 0</code> or <code>port &gt; 65535</code></p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unlisten"><a href="#val-unlisten" class="anchor"></a><code><span><span class="keyword">val</span> unlisten : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>port:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>unlisten t ~port</code> stops any listener on <code>port</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-input"><a href="#val-input" class="anchor"></a><code><span><span class="keyword">val</span> input : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>src:<a href="#type-ipaddr">ipaddr</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="#type-ipaddr">ipaddr</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Cstruct</span>.t <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>input t</code> returns an input function continuation to be passed to the underlying <a href="../IP/index.html"><code>IP</code></a> layer.</p></div></div></div></body></html>